{% import '_macros/forms.html' as forms with context %}
{% import '_macros/widgets.html' as widgets with context %}

{% macro comments_widget(content_object) %}
    {% set comment_list = content_object|get_comment_list %}
    {% set comment_form = content_object|get_comment_form %}
    <h2>{% trans count=comment_list|length %}{{ count }} comments{% endtrans %}</h2>
    {% if user.is_authenticated() %}
        <form action="{{ url('comment.post') }}" method="post">
            {{ forms.csrf_input() }}
            {{ comment_form.content_type }}
            {{ comment_form.object_id }}
            <input type="hidden" name="next" value="{{ request.path }}">
            <div class="left">
                {% if user and user.avatar %}
                    <img src="{{ user.avatar_url }}" alt="{{ user.username }}" class="comment-form-account-avatar">
                {% else %}
                    <img src="{{ STATIC_URL }}images/no-avatar.png" alt="{{ user.username }}" class="comment-form-account-avatar">
                {% endif %}
            </div>
            {{ comment_form.markdown }}
            <span class="help-block right">{{ comment_form.markdown.help_text }}</span>
            <div class="form-field space-top-10">
                <button class="btn btn-primary">{% trans %}Post Comment{% endtrans %}</button>
            </div>
        </form>
    {% else %}
        <p><a href="{{ url('account.login') }}">{% trans %}Please login or create an account to post a comment.{% endtrans %}</a></p>
    {% endif %}
    {% for comment in comment_list %}

    {% endfor %}
{% endmacro %}
