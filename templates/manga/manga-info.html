{% extends 'manga/manga-base.html' %}
{% import '_macros/forms.html' as forms with context %}
{% import '_macros/widgets.html' as widgets with context %}

{% macro tag_widget(tag_list, title) %}
    {% if tag_list %}
        <tr>
            <td width="100"><label class="label-normalized">{{ title }}</label></td>
            <td>
                <div class="manga-info-tag-list">
                    {% for tag in tag_list %}
                        <a href="{{ url('tag', args=[tag.id, tag.slug]) }}" class="manga-info-tag-item">{{ tag.name }}</a>
                    {% endfor %}
                </div>
            </td>
        </tr>
    {% endif %}
{% endmacro %}

{% block title %}{{ manga.title }}{% endblock %}

{% block content %}
    <div class="container">
        <div id="manga-info-cover" class="space-bottom-10">
            <a href="{{ url('manga', args=[manga.id, manga.slug]) }}" title="{{ manga.title }}" class="block">
                {% if manga.cover %}
                    <img class="manga-info-cover-img" src="{{ manga.cover_url }}" alt="{{ manga.title }}">
                {% else %}
                    <img class="manga-info-cover-img" src="{{ STATIC_URL }}images/no-image.png" alt="{{ manga.title }}">
                {% endif %}
                <button class="btn btn-primary btn-block manga-info-cover-action manga-info-cover-action-read">
                    <span class="icon icon-docs space-right"></span>
                    <span>{% trans %}Read Online{% endtrans %}</span>
                </button>
            </a>
            <form action="{{ url('manga.download', args=[manga.id, manga.slug]) }}" method="post">
                {{ forms.csrf_input() }}
                <button class="btn btn-warning btn-block manga-info-cover-action">
                    <span class="icon icon-down-circled space-right"></span>
                    <span>{% trans %}Download{% endtrans %} ({{ archive.file.size|filesizeformat }})</span>
                </button>
            </form>
        </div>
        <div class="manga-info-section">
            <div class="panel panel-thin">
                <h5 class="panel-heading">{% trans %}Uploader{% endtrans %}</h5>
                <div class="panel-body">
                    <a href="#">
                        <span class="left space-right-10">{{ widgets.user_avatar(manga.created_by) }}</span>
                        <strong>{{ manga.created_by }}</strong>
                        <p class="text-secondary text-xsmall space-bottom-0">{% trans date=manga.created_on|naturaltime %}Uploaded {{ date }}{% endtrans %}</p>
                        <div class="clear"></div>
                    </a>
                </div>
            </div>
            <div class="panel panel-thin">
                <h5 class="panel-heading">{% trans %}Description{% endtrans %}</h5>
                <div class="panel-body markdown">
                    {% if manga.markdown %}
                        {{ manga.html }}
                    {% else %}
                        <p>{% trans %}No Description Available{% endtrans %}</p>
                    {% endif %}
                </div>
            </div>
            <div class="panel panel-thin">
                <h5 class="panel-heading">{% trans %}Tags{% endtrans %}</h5>
                <div class="panel-body panel-body-no-padding">
                    <table class="panel-table">
                        {{ tag_widget(manga.tag_dictionary.SCANLATOR, gettext('Scanlators')) }}
                        {{ tag_widget(manga.tag_dictionary.AUTHOR, gettext('Authors')) }}
                        {{ tag_widget(manga.tag_dictionary.CIRCLE, gettext('Circles')) }}
                        {{ tag_widget(manga.tag_dictionary.CONTENT, gettext('Content')) }}
                        {{ tag_widget(manga.tag_dictionary.EVENT, gettext('Event')) }}
                        {{ tag_widget(manga.tag_dictionary.MAGAZINE, gettext('Magazine')) }}
                        {{ tag_widget(manga.tag_dictionary.PARODY, gettext('Parody')) }}
                        {% if manga.tank_id %}
                            <tr>
                                <td><label class="label-normalized">{% trans %}Tank{% endtrans %}</label></td>
                                {% with tag = manga.tank %}
                                    <td>
                                        <div class="inline-block space-right-10">
                                            <div class="manga-info-tag-list"><a href="{{ url('tag', args=[tag.id, tag.slug]) }}" class="manga-info-tag-item">{{ tag.name }}</a></div>
                                        </div>
                                        <span class="inline-block text-xsmall text-normalized">{% trans number=manga.tank_chapter %}Chapter {{ number }}{% endtrans %}</span>
                                    </td>
                                {% endwith %}
                            </tr>
                        {% endif %}
                        {% if manga.collection_id %}
                            <tr>
                                <td><label class="label-normalized">{% trans %}Collection{% endtrans %}</label></td>
                                {% with tag = manga.collection %}
                                    <td>
                                        <div class="inline-block space-right-10">
                                            <div class="manga-info-tag-list"><a href="{{ url('tag', args=[tag.id, tag.slug]) }}" class="manga-info-tag-item">{{ tag.name }}</a></div>
                                        </div>
                                        <span class="inline-block text-xsmall text-normalized">{% trans number=manga.collection_part %}Part {{ number }}{% endtrans %}</span>
                                    </td>
                                {% endwith %}
                            </tr>
                        {% endif %}
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
